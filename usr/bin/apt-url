#!/bin/bash

##--------------------------------------------------------------------------
#   @author :           aetherinox
#   @script :           Proteus apt-url
#   @when   :           2023-10-21 15:33:31
#   @url    :           https://github.com/Aetherinox/proteus-git
#
#   requires chmod +x apt-url
#
##--------------------------------------------------------------------------

FETCH=/usr/lib/apt-move/fetch

##--------------------------------------------------------------------------
#   clean cache
##--------------------------------------------------------------------------

sudo apt-get clean

##--------------------------------------------------------------------------
#   check if %FETCH (apt-move) available
##--------------------------------------------------------------------------

if [ ! -f $FETCH ]; then
	echo 'apt-url requires apt-move'
	echo ' Install with: apt-get install apt-move'
	exit 2
fi

##--------------------------------------------------------------------------
#   check if package provided as param #1
##--------------------------------------------------------------------------

if [ -z "$1" ]; then
	echo 'Usage:'
	echo '  ' $0 '<package>'
	exit 1
fi

##--------------------------------------------------------------------------
#   get url of package
##--------------------------------------------------------------------------

url=$(sudo $FETCH -t $1 | tail -n 1)

##--------------------------------------------------------------------------
#   filter URL-encode with ASCII Value
##--------------------------------------------------------------------------

url=${url//%23/\#}
url=${url//%2b/\+}
url=${url//%2d/\-}
url=${url//%3a/\:}
url=${url//%7e/\~}
url=${url//%7b/\{}
url=${url//%7d/\}}

##--------------------------------------------------------------------------
#   strip filename from url
##--------------------------------------------------------------------------

filename="${url##*/}"

##--------------------------------------------------------------------------
#   return filename and url
#
#	usage:
#		query=$( sudo ./apt-url "$pkg_arch" )
#		app_filename=$( echo "$query" | head -n 1; )
#		app_url=$( echo "$query" | tail -n 1; )
##--------------------------------------------------------------------------

echo $filename
echo $url
